post:
  summary: Validate the csv file to be upload
  description: This route is accessible only to store managers.
  operationId: validateUpload
  tags:
    - movie
  parameters:
    - in: query
      name: enable_tracking
      required: false
      schema:
        type: string
      description: |
        When enable_tracking is true, a tracking url will be sent to the client using which the client can stream the validation result.
        The acceptable values are true, yes or nothing. Examples - /api/movies/upload/validate?enable_tracking, /api/movies/upload/validate?enable_tracking=true and /api/movies/upload/validate?enable_tracking=yes.
    - in: query
      name: delay_event_ms
      required: false
      schema:
        type: integer
        default: 0
        maximum: 1000
      description: |
        The query string delay_event_ms when passed in request will pause for the given millisecond between every row processing.
  requestBody:
    content:
      text/csv:
        schema:
          type: string
          format: binary
          example: |
            tmdb_id,imdb_id,title,original_title,overview,runtime,release_date,genres,countries_of_origin,language,movie_status,popularity,budget,revenue,rating_average,rating_count,poster_url,rental_rate
            658224,tt24218194,some tile for the movie,some original title for the movie,some overview for the movie,104,01/01/2025,['drama','family'],['au'],en,Released,5,900000,12000000,8.5,120,https://example.com/movie_poster.jpg,20
  responses:
    '200':
      description: |
        Depending on enable_tracking query the response will differ. If enable_tracking is set in a request the trackingUrl will be sent in the response to let the client the stream the validation result. If not set, a json with the accumulated validation result will be sent.
      content:
        application/json:
          schema:
            oneOf:
              - type: object
                properties:
                  trackingUrl:
                    type: string
                    description: |
                      The tracking url will be /movies/upload/track_validation with the query string "delay_event_ms"
                      that was to /movies/upload/validate.
                    example: /movies/upload/track_validation?delay_event_ms=500
              - type: object
                properties:
                  totalRows:
                    type: integer
                  invalidRows:
                    type: array
                    items:
                      type: object
                      properties:
                        rowNumber:
                          type: integer
                        reasons:
                          type: array
                          items:
                            type: string
    '400':
      $ref: ../../components/error/badRequest.yaml
    '401':
      $ref: ../../components/error/unauthorized.yaml
    '403':
      $ref: ../../components/error/forbidden.yaml
    '404':
      $ref: ../../components/error/notFound.yaml
    '500':
      $ref: ../../components/error/internalServerError.yaml
