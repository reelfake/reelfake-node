get:
  summary: Track the bulk upload of the movies from the csv file
  description: This route is accessible only to store managers.
  operationId: trackUpload
  tags:
    - movie
  parameters:
    - in: query
      name: delay_event_ms
      required: false
      schema:
        type: integer
        default: 0
        maximum: 1000
      description: |
        The query string delay_event_ms when passed in request will pause for the given millisecond between every row processing. This query string is forwarded from the /movies/upload/validate route.
  responses:
    '200':
      description: |
        Depending on enable_tracking query the response will differ. If the query is added to request and enabled below response stream is send.

        Stream of events with the validation result for the row in the csv file.<br>
        The event payload for the row that is processed is below.<br>
        "data: { 'status': 'processing', 'outcome': 'success', 'rowNumber': \<number\>, 'id': \<number\> }\n\n"
        - status: Indicating whether the validation is in progress or completed.
        - rowNumber: The position of the row in the csv. 1 is for row # 1, 2 for row no. 2 and so on.
        - id: Id of the created movie.

        The event payload for the failed row is below.<br>
        "data: { 'status': 'processing', 'outcome': 'failed', 'rowNumber': <number>, 'reasons': [\<string\>] }\n\n"

        When csv file processing is finished, below event is send.<br>
        "data: { 'status': 'done', 'totalRows': \<number\>, 'successRowsCount': \<number\>, 'failedRowsCount': \<number\> }\n\n"
        - totalRows: The total number of rows in the csv
        - successRowsCount: The number of rows which are processed without any error
        - failedRowsCount: The number of rows which failed to process

        Note: When using EventSource in javascript, in onmessage event handler the data can be accessed through event.data which will be json like below<br>
        { 'status': 'processing', 'outcome': 'success', 'rowNumber': \<number\>, 'id': \<number\> }
      content:
        text/event-stream:
          schema:
            type: string
            example: |
              When processing is in progress
              If the row is successfully processed
              "data: { 'status': 'processing', 'outcome': 'success', 'rowNumber': <number>, 'id': <number> }\n\n"

              If the row is failed to process
              "data: { 'status': 'processing', 'outcome': 'failed', 'rowNumber': <number>, 'reasons': [<string>] }\n\n"

              When processing is done
              "data: { 'status': 'done', 'totalRows': <number>, 'successRowsCount': <number>, 'failedRowsCount': <number> }\n\n"
    '401':
      $ref: ../../components/error/unauthorized.yaml
    '403':
      $ref: ../../components/error/forbidden.yaml
    '500':
      $ref: ../../components/error/internalServerError.yaml
